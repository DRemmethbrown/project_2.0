{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content />
  <meta name="author" content />
  <title>Clinica Sanación - Doctores</title>
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@100;200;300;400;500;600;700;800;900&amp;display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet" />
  <link href="{% static 'css/styles.css' %}" rel="stylesheet" />
</head>
<body class="d-flex flex-column">
  <main class="flex-shrink-0">
    <nav class="navbar navbar-expand-lg navbar-light bg-white py-3">
      <div class="container px-5">
        <a class="navbar-brand" href="index.html"><span class="fw-bolder text-primary">Clinica Sanación</span></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0 small fw-bolder">
            <li class="nav-item"><a class="nav-link" href="index.html">Página principal</a></li>
            <li class="nav-item"><a class="nav-link" href="pacientesCitas.html">Citas y Pacientes</a></li>
            <li class="nav-item"><a class="nav-link active" href="doctores.html">Doctores</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <section class="py-5">
      <div class="container px-5">
        <h1 class="fw-bolder mb-4">Administrar Doctores</h1>

        <!-- List of Doctors -->
        <div id="doctors-list" class="mb-4">
          <h2 class="text-secondary fw-bolder">Lista de Doctores</h2>
          <div id="doctorsContainer" class="row row-cols-1 row-cols-md-2 g-4"></div>
        </div>

        <!-- Button to Add Doctor -->
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addDoctorModal">Agregar Doctor</button>
      </div>
    </section>

    <!-- Modal for Adding Doctor -->
    <div class="modal fade" id="addDoctorModal" tabindex="-1" aria-labelledby="addDoctorModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addDoctorModalLabel">Agregar Doctor</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="addDoctorForm">
              <div class="mb-3">
                <label for="doctorName" class="form-label">Nombre Completo</label>
                <input type="text" class="form-control" id="doctorName" placeholder="Dr. Juan Pérez" required>
              </div>
              <div class="mb-3">
                <label for="doctorSpecialty" class="form-label">Especialidad</label>
                <input type="text" class="form-control" id="doctorSpecialty" placeholder="Cardiología" required>
              </div>
              <div class="mb-3">
                <label for="doctorPhone" class="form-label">Teléfono</label>
                <input type="tel" class="form-control" id="doctorPhone" placeholder="555-123-4567" required>
              </div>
              <div class="mb-3">
                <label for="doctorEmail" class="form-label">Correo Electrónico</label>
                <input type="email" class="form-control" id="doctorEmail" placeholder="doctor@example.com" required>
              </div>
              <button type="submit" class="btn btn-primary">Agregar Doctor</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for Editing Doctor -->
    <div class="modal fade" id="editDoctorModal" tabindex="-1" aria-labelledby="editDoctorModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editDoctorModalLabel">Editar Doctor</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="editDoctorForm">
              <input type="hidden" id="editDoctorIndex">
              <div class="mb-3">
                <label for="editDoctorName" class="form-label">Nombre Completo</label>
                <input type="text" class="form-control" id="editDoctorName" required>
              </div>
              <div class="mb-3">
                <label for="editDoctorSpecialty" class="form-label">Especialidad</label>
                <input type="text" class="form-control" id="editDoctorSpecialty" required>
              </div>
              <div class="mb-3">
                <label for="editDoctorPhone" class="form-label">Teléfono</label>
                <input type="tel" class="form-control" id="editDoctorPhone" required>
              </div>
              <div class="mb-3">
                <label for="editDoctorEmail" class="form-label">Correo Electrónico</label>
                <input type="email" class="form-control" id="editDoctorEmail" required>
              </div>
              <button type="submit" class="btn btn-primary">Guardar Cambios</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white py-4 mt-auto">
    <div class="container px-5">
      <div class="row align-items-center justify-content-between flex-column flex-sm-row">
        <div class="col-auto"><div class="small m-0">Copyright &copy; Clinica Sanación 2024</div></div>
        <div class="col-auto">
          <a class="small" href="#!">Privacy</a>
          <span class="mx-1">&middot;</span>
          <a class="small" href="#!">Terms</a>
          <span class="mx-1">&middot;</span>
          <a class="small" href="#!">Contact</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Script for Managing Doctors -->
  <script>
const doctorsKey = "doctorsClinica";

// Load doctors on page load
document.addEventListener("DOMContentLoaded", () => {
  const doctors = JSON.parse(localStorage.getItem(doctorsKey)) || [];
  renderDoctors(doctors);
});

// Add new doctor
document.getElementById("addDoctorForm").addEventListener("submit", function(event) {
  event.preventDefault();
  const newDoctor = getFormData("doctor");
  const doctors = getDoctors();
  doctors.push(newDoctor);
  saveDoctors(doctors);
  renderDoctors(doctors);
  closeModal("addDoctorModal");
  this.reset();
});

// Edit doctor
document.getElementById("editDoctorForm").addEventListener("submit", function(event) {
  event.preventDefault();
  const index = document.getElementById("editDoctorIndex").value;
  const editedDoctor = getFormData("editDoctor");
  const doctors = getDoctors();
  doctors[index] = editedDoctor;
  saveDoctors(doctors);
  renderDoctors(doctors);
  closeModal("editDoctorModal");
});

function renderDoctors(doctors) {
  const container = document.getElementById("doctorsContainer");
  container.innerHTML = "";

  doctors.forEach((doctor, index) => {
    const doctorCard = `
      <div class="col">
        <div class="card shadow border-0 rounded-4 mb-4">
          <div class="card-body">
            <h5 class="card-title">${doctor.name}</h5>
            <p class="card-text"><strong>Especialidad:</strong> ${doctor.specialty}</p>
            <p class="card-text"><strong>Teléfono:</strong> ${doctor.phone}</p>
            <p class="card-text"><strong>Email:</strong> ${doctor.email}</p>
            <button class="btn btn-primary btn-sm" onclick="openEditDoctorModal(${index})">Editar</button>
            <button class="btn btn-danger btn-sm" onclick="deleteDoctor(${index})">Eliminar</button>
          </div>
        </div>
      </div>`;
    container.insertAdjacentHTML("beforeend", doctorCard);
  });
}

function deleteDoctor(index) {
  const doctors = getDoctors();
  doctors.splice(index, 1);
  saveDoctors(doctors);
  renderDoctors(doctors);
}

function openEditDoctorModal(index) {
  const doctors = getDoctors();
  const doctor = doctors[index];
  document.getElementById("editDoctorIndex").value = index;
  document.getElementById("editDoctorName").value = doctor.name;
  document.getElementById("editDoctorSpecialty").value = doctor.specialty;
  document.getElementById("editDoctorPhone").value = doctor.phone;
  document.getElementById("editDoctorEmail").value = doctor.email;

  const modal = new bootstrap.Modal(document.getElementById("editDoctorModal"));
  modal.show();
}

function getDoctors() {
  return JSON.parse(localStorage.getItem(doctorsKey)) || [];
}

function saveDoctors(doctors) {
  localStorage.setItem(doctorsKey, JSON.stringify(doctors));
}

function getFormData(prefix) {
  return {
    name: document.getElementById(`${prefix}Name`).value,
    specialty: document.getElementById(`${prefix}Specialty`).value,
    phone: document.getElementById(`${prefix}Phone`).value,
    email: document.getElementById(`${prefix}Email`).value,
  };
}

function closeModal(modalId) {
  const modal = bootstrap.Modal.getInstance(document.getElementById(modalId));
  modal.hide();
}
  </script>
</body>
</html>
